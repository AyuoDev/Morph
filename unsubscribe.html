<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
  <title>Unsubscribe â€” Morphara</title>
  <style>
    body { background:#111; color:#fff; font-family:'Segoe UI',sans-serif;
           display:flex; align-items:center; justify-content:center; min-height:100vh; margin:0; }
    .box { text-align:center; max-width:400px; padding:40px; background:#1a1a1a;
           border-radius:16px; border:1px solid #2a2a2a; }
    h2 { margin:0 0 12px; }
    p  { color:#aaa; line-height:1.6; }
    button { background:#6c63ff; color:#fff; border:none; padding:12px 28px;
             border-radius:8px; font-size:14px; cursor:pointer; margin-top:16px; }
  </style>
</head>
<body>
<div class="box" id="box">
  <h2>Unsubscribe</h2>
  <p>Click below to unsubscribe from Morphara update emails.</p>
  <button onclick="unsubscribe()">Unsubscribe Me</button>
  <p id="msg" style="margin-top:16px;color:#4caf50;display:none;"></p>
</div>
<script type="module">
  import { createClient } from "https://esm.sh/@supabase/supabase-js@2";
  const supabase = createClient(
    "https://yjrqcmzkmfawwsppmnkl.supabase.co",
    "sb_publishable_fIkpyaJmmkNhcB1HOeRrKw_xZ0c0miD"
  );

  window.unsubscribe = async () => {
    const token = new URLSearchParams(window.location.search).get("token");
    if (!token) { document.getElementById("msg").style.display="block";
                  document.getElementById("msg").style.color="#e55";
                  document.getElementById("msg").textContent="Invalid link."; return; }

    const { error } = await supabase
      .from("newsletter")
      .update({ subscribed: false })
      .eq("token", token);

    const msg = document.getElementById("msg");
    msg.style.display = "block";
    if (error) { msg.style.color="#e55"; msg.textContent="Something went wrong."; }
    else { msg.style.color="#4caf50"; msg.textContent="You've been unsubscribed. Sorry to see you go!"; }
  };
</script>
</body>
</html>